import{o as B,g as m,c as l,a as s,t as o,h,n as y,b as f,F as L,r as N,w as R,v as $,i as D,u as E,j as C,d as r,k as F,e as c}from"./index-BEZ5EV35.js";import{_ as G,u as K,a as z}from"./_plugin-vue_export-helper-DYbZZMgw.js";const A={class:"chat-page"},J=["innerHTML"],O={class:"chat-container"},U={class:"sidebar"},P=["disabled"],Q=["disabled"],W={class:"aura-sidebar"},X={class:"aura-item pancake"},Y={class:"aura-value"},Z={class:"aura-item garlic"},ss={class:"aura-value"},es={class:"round-info"},ts={class:"chat-main"},as={class:"critique-icon"},ns={class:"critique-content"},os={class:"critique-title"},is={class:"critique-text"},ls={class:"message-avatar"},cs={key:0},rs={key:1},us={class:"message-content"},ds={class:"message-name"},vs={key:0,class:"typing-indicator"},_s={key:1,class:"message-text"},ps={key:2,class:"message-judgment"},ms={class:"input-area"},hs=["disabled"],ys=["disabled"],fs={key:0,class:"mic-modal"},gs={class:"mic-modal-content"},bs={__name:"ChatView",setup(ks){const g=E();F();const i=K(),u=r(""),n=r(!1),_=r(!1),d=r(!1),b=r(""),k=r(""),q=r(""),w=r(""),v=r(null),T=C(()=>i.conversationHistory),M=C(()=>`
    <div class="stage-content">
      <h2 class="stage-title">${i.scenarioName||"å¯¹è¯ä¸­"}</h2>
      <div class="stage-characters">
        <div class="character-avatar">ğŸ‘¨â€ğŸ’¼</div>
      </div>
    </div>
  `),x=async()=>{if(!u.value.trim()||n.value)return;const a=u.value.trim();u.value="",n.value=!0,d.value=!1;try{const e=await i.sendMessage(a,t=>{m(()=>{p()}),t.stage==="final"&&t.data.judgment&&S(t.data.judgment)});await m(),p()}catch(e){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",e),alert("å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{n.value=!1}},S=a=>{b.value=a.type,k.value=a.type==="pancake"?"å›ç­”å¾—ä½“ï¼":"è¸©é›·äº†ï¼",q.value=a.comment,w.value=a.type==="pancake"?"ğŸ¥":"ğŸ§„",d.value=!0,setTimeout(()=>{d.value=!1},3e3)},H=async()=>{if(!n.value){n.value=!0;try{const a=await z.requestRescue(i.sessionId);alert(`ğŸ’¡ æ•‘åœºå»ºè®®ï¼š
${a.suggestion}

ğŸ“ è¯´æ˜ï¼š
${a.explanation}`)}catch(a){console.error("æ•‘åœºå¤±è´¥:",a),alert("æ•‘åœºå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{n.value=!1}}},I=async()=>{if(confirm("ç¡®å®šè¦ç»“æŸå¯¹å†³å—ï¼Ÿ")&&!n.value){n.value=!0;try{await i.endSession(),g.push({path:"/report",query:{config:JSON.stringify(i.sessionConfig||{})}})}catch(a){console.error("ç»“æŸæ¸¸æˆå¤±è´¥:",a),alert("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{n.value=!1}}},V=()=>{_.value=!0},p=()=>{v.value&&(v.value.scrollTop=v.value.scrollHeight)};return B(async()=>{if(!i.sessionId){g.push("/");return}await m(),p()}),(a,e)=>(c(),l("div",A,[s("div",{class:"visual-stage",innerHTML:M.value},null,8,J),s("div",O,[s("aside",U,[s("button",{class:"rescue-btn",onClick:H,disabled:n.value}," ğŸ†˜ æ•‘åœº ",8,P),s("button",{class:"end-btn",onClick:I,disabled:n.value}," ğŸ ç»“æŸå¯¹å†³ ",8,Q),s("div",W,[s("div",X,[e[2]||(e[2]=s("div",{class:"aura-icon"},"ğŸ¥",-1)),e[3]||(e[3]=s("div",{class:"aura-label"},"ç…é¥¼",-1)),s("div",Y,o(h(i).pancakeScore),1)]),s("div",Z,[e[4]||(e[4]=s("div",{class:"aura-icon"},"ğŸ§„",-1)),e[5]||(e[5]=s("div",{class:"aura-label"},"å¤§è’œ",-1)),s("div",ss,o(h(i).garlicScore),1)]),s("div",es,"ç¬¬ "+o(h(i).round)+" è½®",1)])]),s("main",ts,[d.value?(c(),l("div",{key:0,class:y(["critique-box",b.value])},[s("div",as,o(w.value),1),s("div",ns,[s("div",os,o(k.value),1),s("div",is,o(q.value),1)])],2)):f("",!0),s("div",{class:"chat-history",ref_key:"chatHistory",ref:v},[(c(!0),l(L,null,N(T.value,(t,j)=>(c(),l("div",{key:j,class:y(["message",t.role])},[s("div",ls,[t.role==="user"?(c(),l("span",cs,"ğŸ‘¤")):(c(),l("span",rs,o(t.avatar||"ğŸ¤–"),1))]),s("div",us,[s("div",ds,o(t.name||(t.role==="user"?"ä½ ":"AI")),1),t.streaming?(c(),l("div",vs,[...e[6]||(e[6]=[s("span",null,null,-1),s("span",null,null,-1),s("span",null,null,-1)])])):(c(),l("div",_s,o(t.content),1)),t.judgment?(c(),l("div",ps,[s("span",{class:y(t.judgment.type)},o(t.judgment.type==="pancake"?"ğŸ¥":"ğŸ§„")+" "+o(t.judgment.comment),3)])):f("",!0)])],2))),128))],512),s("div",ms,[s("button",{class:"mic-btn",onClick:V,title:"è¯­éŸ³è¾“å…¥"}," ğŸ™ï¸ "),R(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),type:"text",class:"message-input",placeholder:"è¾“å…¥ä½ çš„å›ç­”...",onKeyup:D(x,["enter"]),disabled:n.value},null,40,hs),[[$,u.value]]),s("button",{class:"send-btn",onClick:x,disabled:n.value||!u.value.trim()}," å‘é€ ",8,ys)])])]),_.value?(c(),l("div",fs,[s("div",gs,[e[7]||(e[7]=s("h3",null,"è¯­éŸ³è¾“å…¥",-1)),e[8]||(e[8]=s("p",null,"è¯­éŸ³åŠŸèƒ½å¼€å‘ä¸­...",-1)),s("button",{onClick:e[1]||(e[1]=t=>_.value=!1)},"å…³é—­")])])):f("",!0)]))}},xs=G(bs,[["__scopeId","data-v-83a9c035"]]);export{xs as default};
